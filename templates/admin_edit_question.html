{% extends "base.html" %}
{% block title %}Muokkaa kysymystä{% endblock %}

{% block content %}
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1>✏️ Muokkaa kysymystä (ID: {{ question['id'] }})</h1>
        <a href="{{ url_for('admin_route') }}" class="btn btn-secondary">← Palaa Admin-paneeliin</a>
    </div>

    <div class="card shadow-sm">
        <div class="card-body">
            {% with messages = get_flashed_messages(with_categories=true) %}
                {% if messages %}
                    {% for category, message in messages %}
                        <div class="alert alert-{{ category }} alert-dismissible fade show" role="alert">
                            {{ message }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                    {% endfor %}
                {% endif %}
            {% endwith %}

            <form method="POST" action="{{ url_for('admin_edit_question_route', question_id=question['id']) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">

                <div class="mb-3">
                    <label class="form-label">Kysymysteksti</label>
                    <textarea name="question" class="form-control" required>{{ question['question'] }}</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Vastausvaihtoehdot (Valitse oikea vastaus)</label>
                    {% for i in range(4) %}
                    <div class="mb-2 d-flex align-items-center">
                        <div class="form-check me-3">
                            <input type="radio" name="correct" value="{{ i }}" class="form-check-input" {% if question['correct'] == i %}checked{% endif %}>
                            <label class="form-check-label">{{ ['A', 'B', 'C', 'D'][i] }}</label>
                        </div>
                        <input type="text" name="option_{{ i }}" class="form-control" style="width: 80%;" value="{{ question['options'][i] if question['options'] and i < question['options']|length else '' }}" required>
                    </div>
                    {% endfor %}
                </div>

                <div class="mb-3">
                    <label class="form-label">Selitys</label>
                    <textarea name="explanation" class="form-control" required>{{ question['explanation'] }}</textarea>
                </div>

                <div class="mb-3">
                    <label class="form-label">Kategoria</label>
                    <select name="category" class="form-select" required id="categorySelect">
                        {% for category in categories %}
                            <option value="{{ category }}" {% if category == question['category'] %}selected{% endif %}>{{ category.title() }}</option>
                        {% endfor %}
                        <option value="new_category">... Lisää uusi kategoria ...</option>
                    </select>
                    <input type="text" name="new_category" class="form-control mt-2 d-none" id="newCategoryInput" placeholder="Syötä uusi kategoria (jos valittu)">
                </div>

                <div class="mb-3">
                    <label class="form-label">Vaikeustaso</label>
                    <select name="difficulty" class="form-select" required>
                        <option value="helppo" {% if question['difficulty'] == 'helppo' %}selected{% endif %}>Helppo</option>
                        <option value="keskivaikea" {% if question['difficulty'] == 'keskivaikea' %}selected{% endif %}>Keskivaikea</option>
                        <option value="vaikea" {% if question['difficulty'] == 'vaikea' %}selected{% endif %}>Vaikea</option>
                    </select>
                </div>

                <div class="d-flex justify-content-between">
                    <a href="{{ url_for('admin_route') }}" class="btn btn-secondary">Peruuta</a>
                    <button type="submit" class="btn btn-primary">Tallenna muutokset</button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('categorySelect').addEventListener('change', function() {
    const newCategoryInput = document.getElementById('newCategoryInput');
    if (this.value === 'new_category') {
        newCategoryInput.classList.remove('d-none');
        newCategoryInput.required = true;
    } else {
        newCategoryInput.classList.add('d-none');
        newCategoryInput.required = false;
        newCategoryInput.value = '';
    }
});
</script>
{% endblock %}