{% extends "base.html" %}

{% block title %}Dashboard - LOVe Enhanced{% endblock %}

{% block extra_css %}
<style>
    /* Hero Navigation - 3 isoa nappia */
    .hero-navigation {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 1.5rem;
        margin-bottom: 2rem;
    }
    
    .hero-card {
        background: linear-gradient(135deg, var(--card-color-start) 0%, var(--card-color-end) 100%);
        border-radius: 16px;
        padding: 2rem;
        text-align: center;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        border: none;
        color: white;
        position: relative;
        overflow: hidden;
        min-height: 200px;
        display: flex;
        flex-direction: column;
        justify-content: center;
    }
    
    .hero-card:hover {
        transform: translateY(-8px);
        box-shadow: 0 12px 24px rgba(0,0,0,0.15);
    }
    
    .hero-card.practice {
        --card-color-start: #667eea;
        --card-color-end: #764ba2;
    }
    
    .hero-card.review {
        --card-color-start: #f093fb;
        --card-color-end: #f5576c;
    }
    
    .hero-card.test {
        --card-color-start: #4facfe;
        --card-color-end: #00f2fe;
    }
    
    .hero-card .icon {
        font-size: 3rem;
        margin-bottom: 1rem;
    }
    
    .hero-card h3 {
        font-size: 1.5rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
        color: white;
    }
    
    .hero-card p {
        opacity: 0.9;
        margin-bottom: 0;
        color: white;
    }
    
    .hero-card .badge-notify {
        position: absolute;
        top: 1rem;
        right: 1rem;
        background: rgba(255,255,255,0.3);
        backdrop-filter: blur(10px);
        padding: 0.4rem 0.8rem;
        border-radius: 20px;
        font-weight: 600;
        font-size: 0.9rem;
    }
    
    /* Smart Recommendation Card */
    .smart-recommendation {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 16px;
        padding: 2rem;
        margin-bottom: 2rem;
        color: white;
        position: relative;
        overflow: hidden;
    }
    
    .smart-recommendation::before {
        content: '';
        position: absolute;
        top: -50%;
        right: -50%;
        width: 200%;
        height: 200%;
        background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 70%);
        animation: pulse 3s ease-in-out infinite;
    }
    
    @keyframes pulse {
        0%, 100% { transform: scale(1); opacity: 0.5; }
        50% { transform: scale(1.1); opacity: 0.8; }
    }
    
    .smart-recommendation .content {
        position: relative;
        z-index: 1;
    }
    
    .smart-recommendation h4 {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        margin-bottom: 1rem;
        font-size: 1.2rem;
    }
    
    .smart-recommendation .recommendation-text {
        font-size: 1.1rem;
        margin-bottom: 1.5rem;
        opacity: 0.95;
    }
    
    .smart-recommendation .action-buttons {
        display: flex;
        gap: 1rem;
        flex-wrap: wrap;
    }
    
    .smart-recommendation .btn {
        background: rgba(255,255,255,0.2);
        border: 2px solid rgba(255,255,255,0.3);
        color: white;
        backdrop-filter: blur(10px);
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .smart-recommendation .btn:hover {
        background: rgba(255,255,255,0.3);
        border-color: rgba(255,255,255,0.5);
        transform: translateY(-2px);
    }
    
    /* Stats Overview */
    .stats-overview {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 1rem;
        margin-bottom: 2rem;
    }
    
    .stat-card {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        text-align: center;
        box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        transition: transform 0.2s ease;
    }
    
    .stat-card:hover {
        transform: translateY(-4px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.12);
    }
    
    .stat-card .stat-icon {
        font-size: 2rem;
        margin-bottom: 0.5rem;
    }
    
    .stat-card .stat-value {
        font-size: 1.8rem;
        font-weight: 700;
        color: #667eea;
        margin-bottom: 0.25rem;
    }
    
    .stat-card .stat-label {
        font-size: 0.9rem;
        color: #6b7280;
        font-weight: 500;
    }
    
    /* Responsive */
    @media (max-width: 992px) {
        .hero-navigation {
            grid-template-columns: 1fr;
        }
        
        .stats-overview {
            grid-template-columns: repeat(2, 1fr);
        }
    }
    
    @media (max-width: 576px) {
        .stats-overview {
            grid-template-columns: 1fr;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">
    <!-- Welcome Header -->
    <div class="mb-4">
        <h1 class="display-4">Tervetuloa takaisin, {{ current_user.username }}! üëã</h1>
        <p class="lead text-muted">Mit√§ tehd√§√§n seuraavaksi?</p>
    </div>
    
    <!-- Hero Navigation - 3 p√§√§nappia -->
    <div class="hero-navigation">
        <!-- HARJOITTELE -->
        <a href="#" class="hero-card practice" onclick="openPracticeModal(); return false;">
            <div class="icon">üìö</div>
            <h3>HARJOITTELE</h3>
            <p>Opi uutta ilman painetta</p>
        </a>
        
        <!-- KERTAA -->
        <a href="/review" class="hero-card review">
            {% if due_reviews > 0 %}
            <span class="badge-notify">{{ due_reviews }} er√§√§ntynyt</span>
            {% endif %}
            <div class="icon">üîÑ</div>
            <h3>KERTAA</h3>
            <p>√Ñlyk√§s kertaus (SR)</p>
        </a>
        
        <!-- TESTAA -->
        <a href="#" class="hero-card test" onclick="openTestModal(); return false;">
            <div class="icon">üéì</div>
            <h3>TESTAA</h3>
            <p>Arvioi osaaminen</p>
        </a>
    </div>
    
    <!-- Smart Recommendation -->
    {% if recommendation %}
    <div class="smart-recommendation">
        <div class="content">
            <h4>
                {% if recommendation.priority == 'high' %}‚ö†Ô∏è{% elif recommendation.priority == 'medium' %}üí°{% else %}‚ú®{% endif %}
                √Ñlyk√§s suositus
            </h4>
            <div class="recommendation-text">
                <strong>{{ recommendation.title }}</strong><br>
                {{ recommendation.description }}
            </div>
            <div class="action-buttons">
                {% if recommendation.action == 'practice_category' %}
                <a href="/practice?category={{ recommendation.category }}" class="btn">
                    üí™ Harjoittele t√§t√§
                </a>
                {% elif recommendation.action == 'start_simulation' %}
                <a href="/simulation" class="btn">
                    üéØ Aloita simulaatio
                </a>
                {% endif %}
                <a href="/stats" class="btn">
                    üìä N√§yt√§ tilastot
                </a>
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Stats Overview -->
    <div class="stats-overview">
        <!-- Streak -->
        <div class="stat-card">
            <div class="stat-icon">üî•</div>
            <div class="stat-value">{{ streak.current_streak }}</div>
            <div class="stat-label">P√§iv√§n putki</div>
        </div>
        
        <!-- Progress -->
        <div class="stat-card">
            <div class="stat-icon">üèÜ</div>
            <div class="stat-value">{{ answered_questions }}/{{ total_questions }}</div>
            <div class="stat-label">Kysymyst√§ harjoiteltu</div>
        </div>
        
        <!-- This Week -->
        <div class="stat-card">
            <div class="stat-icon">üìà</div>
            <div class="stat-value">+{{ weekly_improvement }}%</div>
            <div class="stat-label">Viikon edistys</div>
        </div>
        
        <!-- Achievements -->
        <div class="stat-card">
            <div class="stat-icon">‚≠ê</div>
            <div class="stat-value">{{ unlocked_achievements }}/16</div>
            <div class="stat-label">Saavutusta avattu</div>
        </div>
    </div>
    
    <!-- Recent Activity / Quick Links -->
    <div class="row">
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üìä Kategoriat</h5>
                </div>
                <div class="card-body">
                    {% for category in categories[:5] %}
                    <div class="d-flex justify-content-between align-items-center mb-2">
                        <span>{{ category.name }}</span>
                        <div>
                            <span class="badge bg-{{ 'success' if category.success_rate >= 0.8 else 'warning' if category.success_rate >= 0.6 else 'danger' }}">
                                {{ (category.success_rate * 100)|round }}%
                            </span>
                            <a href="/practice?category={{ category.name }}" class="btn btn-sm btn-outline-primary ms-2">
                                Harjoittele
                            </a>
                        </div>
                    </div>
                    {% endfor %}
                    <a href="/stats" class="btn btn-sm btn-link">N√§yt√§ kaikki ‚Üí</a>
                </div>
            </div>
        </div>
        
        <div class="col-md-6">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">üèÜ Viimeisimm√§t saavutukset</h5>
                </div>
                <div class="card-body">
                    {% if recent_achievements %}
                        {% for achievement in recent_achievements[:3] %}
                        <div class="d-flex align-items-center mb-3">
                            <div class="me-3" style="font-size: 2rem;">{{ achievement.icon }}</div>
                            <div>
                                <strong>{{ achievement.name }}</strong><br>
                                <small class="text-muted">{{ achievement.unlocked_at }}</small>
                            </div>
                        </div>
                        {% endfor %}
                        <a href="/achievements" class="btn btn-sm btn-link">N√§yt√§ kaikki ‚Üí</a>
                    {% else %}
                        <p class="text-muted">Aloita harjoittelu avataksesi saavutuksia!</p>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Practice Modal -->
<div class="modal fade" id="practiceModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üìö Valitse harjoittelutapa</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="d-grid gap-3">
                    <!-- Satunnainen -->
                    <a href="/practice?mode=random" class="btn btn-lg btn-outline-primary text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">üé≤</span>
                            <div>
                                <strong>Satunnainen harjoitus</strong><br>
                                <small class="text-muted">20 kysymyst√§ kaikista aiheista</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Heikot alueet -->
                    <a href="/practice?mode=weakest" class="btn btn-lg btn-outline-warning text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">üí™</span>
                            <div>
                                <strong>Heikot alueet</strong><br>
                                <small class="text-muted">J√§rjestelm√§ valitsee automaattisesti</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Valitse kategoriat -->
                    <a href="/practice?mode=custom" class="btn btn-lg btn-outline-info text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">üéØ</span>
                            <div>
                                <strong>Valitse aiheet</strong><br>
                                <small class="text-muted">1-3 kategoriaa, 10-20 kysymyst√§</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Vaikeustaso -->
                    <a href="/practice?mode=difficulty" class="btn btn-lg btn-outline-secondary text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">‚ö°</span>
                            <div>
                                <strong>Valitse vaikeustaso</strong><br>
                                <small class="text-muted">Helppo, Keskivaikea tai Vaikea</small>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Test Modal -->
<div class="modal fade" id="testModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">üéì Valitse testin tyyppi</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="d-grid gap-3">
                    <!-- Nopea testi -->
                    <a href="/test/quick" class="btn btn-lg btn-outline-success text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">‚ö°</span>
                            <div>
                                <strong>Nopea testi</strong><br>
                                <small class="text-muted">20 kysymyst√§ ‚Ä¢ 20 minuuttia ‚Ä¢ Valitse aiheet</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- Kategoriatesti -->
                    <a href="/test/category" class="btn btn-lg btn-outline-primary text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">üéØ</span>
                            <div>
                                <strong>Kategoriatesti</strong><br>
                                <small class="text-muted">30 kysymyst√§ ‚Ä¢ 30 minuuttia ‚Ä¢ 1-3 kategoriaa</small>
                            </div>
                        </div>
                    </a>
                    
                    <!-- T√§ysi simulaatio -->
                    <a href="/simulation" class="btn btn-lg btn-outline-danger text-start">
                        <div class="d-flex align-items-center">
                            <span class="me-3" style="font-size: 2rem;">üèÜ</span>
                            <div>
                                <strong>T√§ysi simulaatio</strong><br>
                                <small class="text-muted">50 kysymyst√§ ‚Ä¢ 60 minuuttia ‚Ä¢ Kaikki aiheet</small>
                            </div>
                        </div>
                    </a>
                </div>
            </div>
            <div class="modal-footer">
                <small class="text-muted">
                    <i class="fas fa-info-circle"></i> Testitulokset n√§kyv√§t tilastoissasi
                </small>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
function openPracticeModal() {
    const modal = new bootstrap.Modal(document.getElementById('practiceModal'));
    modal.show();
}

function openTestModal() {
    const modal = new bootstrap.Modal(document.getElementById('testModal'));
    modal.show();
}
</script>
{% endblock %}