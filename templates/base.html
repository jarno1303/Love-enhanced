<!DOCTYPE html>
<html lang="fi">
<head>
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-R8Z9S5GZXC"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-R8Z9S5GZXC');
    </script>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LOVe Enhanced{% endblock %}</title>

    {# K√§yt√§ uudempaa versiota, jos mahdollista, esim. 5.3.3 #}
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-9ndCyUaIbzAi2FUVXJi0CjmCapSmO7SnpJef0486qhLnuZ2cdeRhO02iuK6FUUVM" crossorigin="anonymous">

    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw==" crossorigin="anonymous" referrerpolicy="no-referrer" />

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">

    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        /* ============================================
           üé® WOW: CSS CUSTOM PROPERTIES (Design System)
           ============================================ */
        :root {
            /* Primary Colors */
            --primary-color: #5A67D8; /* Indigo 600 */
            --primary-light: #7F9CF5; /* Indigo 400 */
            --primary-dark: #4C51BF; /* Indigo 700 */
            --primary-glow: rgba(90, 103, 216, 0.4);

            /* Secondary Colors */
            --secondary-color: #718096; /* Cool Gray 500 */
            --accent-color: #ED64A6; /* Pink 500 */
            --success-color: #48BB78; /* Green 500 */
            --warning-color: #ECC94B; /* Yellow 500 */
            --danger-color: #F56565; /* Red 500 */
            --info-color: #4299E1; /* Blue 500 */

            /* Neutrals */
            --light-bg: #F7FAFC; /* Cool Gray 50 */
            --light-hover: #EDF2F7; /* Cool Gray 100 */
            --medium-color: #A0AEC0; /* Cool Gray 400 */
            --dark-color: #2D3748; /* Cool Gray 800 */
            --white-color: #FFFFFF;
            --border-color: #E2E8F0; /* Cool Gray 200 */
            --text-primary: #2D3748;
            --text-secondary: #718096;

            /* Badges */
            --gold: #ECC94B;
            --silver: #E2E8F0;
            --bronze: #CD7F32; /* Ruskeampi pronssi */

            /* üé® WOW: Gradients */
            --gradient-primary: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --gradient-success: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            --gradient-danger: linear-gradient(135deg, #ef4444 0%, #f87171 100%); /* Punaisempi */
            --gradient-info: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            --gradient-warning: linear-gradient(135deg, #f59e0b 0%, #fcd34d 100%); /* Keltaisempi */
            --gradient-animated: linear-gradient(270deg, #667eea, #764ba2, #ec4899, #4facfe); /* Pinkimpi */
            background-size: 400% 400%; /* Tarvitaan animaatioon */


            /* üé® WOW: Shadows */
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --shadow-glow: 0 0 20px var(--primary-glow);

            /* üé® WOW: Transitions */
            --transition-fast: 0.2s ease;
            --transition-normal: 0.3s ease;
            --transition-slow: 0.5s ease;

            /* üé® WOW: Border Radius */
            --radius-sm: 0.25rem; /* 4px */
            --radius-md: 0.5rem; /* 8px */
            --radius-lg: 0.75rem; /* 12px */
            --radius-xl: 1rem; /* 16px */
            --radius-full: 9999px;
        }

        /* Dark Mode Variables */
        body.dark-mode {
            --primary-color: #8b5cf6; /* Violet 500 */
            --primary-light: #a78bfa; /* Violet 400 */
            --primary-dark: #7c3aed; /* Violet 600 */
            --secondary-color: #9ca3af; /* Gray 400 */
            --accent-color: #ec4899; /* Pink 500 */
            --success-color: #10b981; /* Emerald 500 */
            --warning-color: #f59e0b; /* Amber 500 */
            --danger-color: #ef4444; /* Red 500 */
            --info-color: #3b82f6; /* Blue 500 */

            --light-bg: #111827; /* Gray 900 */
            --light-hover: #1f2937; /* Gray 800 */
            --medium-color: #6b7280; /* Gray 500 */
            --dark-color: #030712; /* Gray 950 */
            --white-color: #1f2937; /* Gray 800 - Korttien tausta */
            --border-color: #374151; /* Gray 700 */
            --text-primary: #f9fafb; /* Gray 50 */
            --text-secondary: #9ca3af; /* Gray 400 */

            --gold: #fbbf24; /* Amber 400 */
            --silver: #d1d5db; /* Gray 300 */
            --bronze: #d97706; /* Amber 600 */

            --gradient-animated: linear-gradient(270deg, #8b5cf6, #7c3aed, #ec4899, #3b82f6);
            background-size: 400% 400%;
        }

        /* ============================================
           üåä WOW: ANIMATED GRADIENT BACKGROUND
           ============================================ */
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--gradient-animated);
            background-size: 400% 400%; /* Oltava m√§√§ritelty animaatiota varten */
            animation: gradientShift 20s ease infinite alternate; /* Hitaampi ja pehme√§mpi */
            color: var(--text-primary);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
            overflow-x: hidden; /* Est√§ vaakavieritys */
            display: flex; /* Flexbox layout koko sivulle */
            flex-direction: column; /* J√§rjest√§ lapset (nav, main, footer) allekkain */
        }

        @keyframes gradientShift {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Subtle overlay for readability */
        body::before {
            content: '';
            position: fixed; /* Peitt√§√§ koko n√§kym√§n */
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(255, 255, 255, 0.88); /* Vaalea tila, hieman l√§pin√§kyv√§mpi */
            z-index: -1; /* Taustan alle */
            pointer-events: none; /* Ei est√§ klikkauksia */
            transition: background var(--transition-normal); /* Pehme√§ vaihto */
        }

        body.dark-mode::before {
            background: rgba(17, 24, 39, 0.92); /* Gray 900 dark modessa, l√§pin√§kyv√§mpi */
        }

        /* P√§√§sis√§lt√∂alue kasvaa t√§ytt√§m√§√§n tilan */
        .container-main {
            flex: 1; /* Ota kaikki vapaa tila navin ja footerin v√§list√§ */
            padding-top: 2rem;
            padding-bottom: 4rem; /* Lis√§√§ tilaa ennen footeria */
            animation: pageEnter 0.6s cubic-bezier(0.25, 0.46, 0.45, 0.94); /* Pehme√§mpi animaatio */
        }

        @keyframes pageEnter {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ============================================
           ‚ú® GLASSMORPHISM NAVBAR (PARANNETTU KONTRASTI)
           ============================================ */
        .navbar {
            /* K√§yt√§ vaaleaa lasia vaaleassa tilassa */
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(15px) saturate(150%);
            -webkit-backdrop-filter: blur(15px) saturate(150%);
            border-bottom: 1px solid rgba(0, 0, 0, 0.08);
            box-shadow: var(--shadow-md);
            transition: background var(--transition-normal);
            position: sticky; /* Pysyy ylh√§√§ll√§ */
            top: 0;
            z-index: 1030; /* Bootstrapin navbari z-index */
        }

        body.dark-mode .navbar {
            /* K√§yt√§ tummaa lasia dark modessa */
            background: rgba(31, 41, 55, 0.75); /* Gray 800 */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .navbar-brand {
            font-weight: 800;
            font-size: 1.4rem;
            color: var(--primary-dark) !important; /* Tummempi br√§ndin v√§ri */
            transition: all var(--transition-fast);
        }
        body.dark-mode .navbar-brand {
            color: var(--primary-light) !important; /* Vaaleampi br√§ndin v√§ri dark modessa */
        }

        .navbar-brand:hover {
            opacity: 0.8;
            transform: scale(1.02);
        }
        .navbar-brand i {
             color: var(--primary-color);
             transition: transform 0.3s ease;
        }
        .navbar-brand:hover i {
             transform: rotate(15deg);
        }


        .nav-link {
            color: var(--text-secondary) !important; /* Pehme√§mpi linkin v√§ri */
            font-weight: 600;
            padding: 0.6rem 1rem !important;
            border-radius: var(--radius-md);
            transition: all var(--transition-fast);
            position: relative;
        }
        body.dark-mode .nav-link {
            color: var(--text-secondary) !important;
        }

        /* Nav link underline effect */
        .nav-link::before {
            content: '';
            position: absolute;
            bottom: 4px; /* Ylemp√§n√§ */
            left: 50%;
            width: 0%;
            height: 2px;
            background: var(--primary-color);
            transition: all var(--transition-normal);
            transform: translateX(-50%);
        }
        body.dark-mode .nav-link::before {
            background: var(--primary-light);
        }


        .nav-link:hover {
            color: var(--text-primary) !important;
            background: rgba(0, 0, 0, 0.03); /* Kevyt hover-tausta */
        }
        body.dark-mode .nav-link:hover {
            color: var(--text-primary) !important;
            background: rgba(255, 255, 255, 0.05);
        }

        .nav-link:hover::before {
            width: 60%;
        }

        .nav-link.active {
            color: var(--primary-color) !important;
            background: rgba(90, 103, 216, 0.1); /* Aktiivisen linkin tausta */
        }
        body.dark-mode .nav-link.active {
            color: var(--primary-light) !important;
            background: rgba(139, 92, 246, 0.15);
        }
        .nav-link.active::before {
             width: 80%; /* Leve√§mpi viiva aktiiviselle */
        }


        /* ============================================
           üí´ WOW: MIKROINTERAKTIOT
           ============================================ */
        .btn {
            transition: all var(--transition-fast);
            border: none;
            font-weight: 600;
            position: relative;
            overflow: hidden; /* Piilota ripple-efektin ylitys */
            border-radius: var(--radius-md); /* Yhten√§inen py√∂ristys */
            padding: 0.6rem 1.2rem; /* Sopiva padding */
        }

        /* Ripple effect */
        .btn::after { /* K√§yt√§ ::after */
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 5px; /* Aloita pienemp√§n√§ */
            height: 5px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.5);
            transform: translate(-50%, -50%) scale(0); /* Aloita skaalattuna nollaan */
            transition: transform 0.6s ease, opacity 0.8s ease; /* Lis√§√§ opacity */
            opacity: 0;
            pointer-events: none; /* Ei est√§ klikkausta */
        }

        .btn:active::after {
            transform: translate(-50%, -50%) scale(100); /* Laajenna suureksi */
            opacity: 1;
            transition: transform 0s, opacity 0s; /* V√§lit√∂n efekti painettaessa */
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .btn:active {
            transform: translateY(0px); /* Palauta hieman */
            box-shadow: var(--shadow-sm); /* Pienempi varjo */
        }

        .btn-primary {
            background: var(--gradient-primary);
            color: white; /* Varmista tekstin v√§ri */
            border-color: transparent;
        }

        .btn-primary:hover {
            background: var(--gradient-primary);
            filter: brightness(1.1); /* Kirkasta hieman hoverissa */
             color: white;
        }

        .btn-secondary {
             background-color: var(--white-color);
             color: var(--text-secondary);
             border: 1px solid var(--border-color);
        }
        body.dark-mode .btn-secondary {
             background-color: var(--white-color); /* K√§yt√§ dark mode white */
             color: var(--text-secondary);
             border: 1px solid var(--border-color);
        }
        .btn-secondary:hover {
             background-color: var(--light-hover);
             border-color: var(--medium-color);
             color: var(--text-primary);
        }

        .btn-outline-secondary {
            color: var(--text-secondary);
            border-color: var(--border-color);
        }
         body.dark-mode .btn-outline-secondary {
             color: var(--text-secondary);
            border-color: var(--border-color);
         }
        .btn-outline-secondary:hover {
             background-color: var(--light-hover);
             border-color: var(--medium-color);
             color: var(--text-primary);
        }


        /* ============================================
           üÉè WOW: CARD ANIMATIONS & STYLES
           ============================================ */
        .card {
            border: 1px solid var(--border-color); /* Lis√§√§ hienovarainen reuna */
            border-radius: var(--radius-lg);
            background: var(--white-color); /* K√§yt√§ CSS-muuttujaa */
            box-shadow: var(--shadow-md);
            transition: all var(--transition-normal);
            /* backdrop-filter: blur(5px); Poistettu yleisest√§, voi lis√§t√§ tarvittaessa */
            overflow: hidden; /* Varmista, ett√§ sis√§lt√∂ pysyy kulmien sis√§ll√§ */
        }

        body.dark-mode .card {
            background: var(--white-color); /* K√§yt√§ dark mode white */
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-5px); /* Hienovaraisempi nosto */
            box-shadow: var(--shadow-lg); /* Hillitympi varjo */
        }
        .card-header {
            background-color: var(--light-bg); /* Yhten√§inen tausta */
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 1.25rem;
            font-weight: 600;
        }
        body.dark-mode .card-header {
            background-color: var(--light-hover);
            border-bottom: 1px solid var(--border-color);
        }
         .card-body {
             padding: 1.5rem; /* Lis√§√§ paddingia */
         }


        /* ============================================
           ‚è≥ WOW: SKELETON SCREENS
           ============================================ */
        .skeleton {
            background: linear-gradient(90deg, var(--light-hover) 25%, var(--border-color) 50%, var(--light-hover) 75%);
            background-size: 200% 100%;
            animation: loading 1.8s infinite linear; /* Hieman hitaampi */
            border-radius: var(--radius-md);
            opacity: 0.7; /* Hieman l√§pin√§kyv√§ */
        }

        body.dark-mode .skeleton {
            background: linear-gradient(90deg, #2d3748 25%, #1f2937 50%, #2d3748 75%);
            background-size: 200% 100%;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        .skeleton-text {
            height: 1rem;
            margin-bottom: 0.75rem; /* Lis√§√§ v√§li√§ */
            border-radius: var(--radius-sm); /* Pienempi py√∂ristys */
        }
        .skeleton-text:last-child {
            margin-bottom: 0;
        }
        .skeleton-text.short { width: 60%; }
        .skeleton-text.medium { width: 80%; }

        .skeleton-card {
            height: 150px; /* Matalampi kortti */
            border-radius: var(--radius-lg);
        }
        .skeleton-avatar {
             width: 40px;
             height: 40px;
             border-radius: 50%;
        }


        /* ============================================
           üé® MODERN ELEMENTS
           ============================================ */
        .alert {
            border-radius: var(--radius-md);
            border: none; /* Poista Bootstrapin oletusreuna */
            border-left: 4px solid; /* Lis√§√§ vasen korostusreuna */
            box-shadow: var(--shadow-sm); /* Kevyt varjo */
            /* backdrop-filter: blur(5px); Poistettu, voi hidastaa */
            animation: slideDown 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94);
            padding: 1rem 1.25rem;
        }
        /* Aseta reunav√§rit */
        .alert-success { border-left-color: var(--success-color); background-color: rgba(72, 187, 120, 0.1); color: #047857;}
        .alert-danger, .alert-error { border-left-color: var(--danger-color); background-color: rgba(245, 101, 101, 0.1); color: #b91c1c; }
        .alert-warning { border-left-color: var(--warning-color); background-color: rgba(236, 201, 75, 0.1); color: #92400e; }
        .alert-info { border-left-color: var(--info-color); background-color: rgba(66, 153, 225, 0.1); color: #2c5282; }

        body.dark-mode .alert { box-shadow: none; }
        body.dark-mode .alert-success { background-color: rgba(16, 185, 129, 0.15); color: #6ee7b7; border-left-color: #10b981; }
        body.dark-mode .alert-danger, body.dark-mode .alert-error { background-color: rgba(239, 68, 68, 0.15); color: #fca5a5; border-left-color: #ef4444; }
        body.dark-mode .alert-warning { background-color: rgba(245, 158, 11, 0.15); color: #fcd34d; border-left-color: #f59e0b; }
        body.dark-mode .alert-info { background-color: rgba(59, 130, 246, 0.15); color: #93c5fd; border-left-color: #3b82f6; }


        @keyframes slideDown {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Form controls */
        .form-control, .form-select {
            border-radius: var(--radius-md);
            border: 1px solid var(--border-color); /* Ohuempi reuna */
            padding: 0.75rem 1rem;
            transition: all var(--transition-fast);
            background-color: var(--white-color); /* Tausta */
            color: var(--text-primary);
        }
         .form-control::placeholder {
             color: var(--medium-color);
         }
        body.dark-mode .form-control, body.dark-mode .form-select {
             background-color: var(--light-hover); /* Tummempi tausta dark modessa */
             border: 1px solid var(--border-color);
             color: var(--text-primary);
        }
         body.dark-mode .form-control::placeholder {
             color: var(--medium-color);
         }


        .form-control:focus, .form-select:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px var(--primary-glow);
            /* transform: translateY(-1px); Poistettu, voi olla h√§iritsev√§ */
            background-color: var(--white-color); /* Varmista tausta focusissa */
        }
         body.dark-mode .form-control:focus, body.dark-mode .form-select:focus {
             background-color: var(--light-hover);
             border-color: var(--primary-light);
             box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.3); /* Violetti glow */
         }

        /* Checkboxit ja radiobuttonit */
        .form-check-input {
             border-color: var(--border-color);
        }
        .form-check-input:checked {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
         .form-check-input:focus {
             box-shadow: 0 0 0 3px var(--primary-glow);
         }

        /* ============================================
           üé™ THEME TOGGLE (Parannettu ulkoasu)
           ============================================ */
        .theme-toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem; /* Pienempi v√§li */
            padding: 0.3rem 0.6rem; /* Pienempi padding */
            background: rgba(0, 0, 0, 0.05); /* L√§pikuultava tausta */
            border-radius: var(--radius-full); /* T√§ysin py√∂re√§ */
            /* backdrop-filter: blur(5px); Poistettu, voi hidastaa */
            transition: all var(--transition-fast);
            cursor: pointer;
        }
        body.dark-mode .theme-toggle-wrapper {
            background: rgba(255, 255, 255, 0.1);
        }

        .theme-toggle-wrapper:hover {
            background: rgba(0, 0, 0, 0.08);
            transform: scale(1.03); /* Kevyt skaalaus hoverissa */
        }
         body.dark-mode .theme-toggle-wrapper:hover {
             background: rgba(255, 255, 255, 0.15);
         }


        /* Piilotetaan checkbox visuaalisesti, mutta pidet√§√§n se saavutettavana */
        .theme-toggle-switch input {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .theme-toggle-icons {
             display: flex;
             align-items: center;
             justify-content: space-between; /* Asettele ikonit p√§ihin */
             width: 48px; /* M√§√§rit√§ leveys */
             height: 26px; /* M√§√§rit√§ korkeus */
             background-color: var(--medium-color); /* Oletustausta */
             border-radius: var(--radius-full);
             padding: 2px;
             position: relative;
             cursor: pointer;
             transition: background-color var(--transition-normal);
        }
         body.dark-mode .theme-toggle-icons {
              background-color: var(--border-color);
         }


        .theme-toggle-icons::before { /* Liukupallo */
            content: "";
            position: absolute;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background-color: white;
            top: 3px;
            left: 3px;
            transition: transform var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }

        .theme-toggle-switch input:checked + .theme-toggle-icons {
             background-color: var(--primary-color); /* V√§ri kun dark mode p√§√§ll√§ */
        }

        .theme-toggle-switch input:checked + .theme-toggle-icons::before {
            transform: translateX(22px); /* Siirr√§ pallo oikealle */
        }


        .theme-toggle-icon {
            font-size: 0.9rem; /* Pienemm√§t ikonit */
            color: var(--white-color); /* Valkoinen oletuksena */
            z-index: 1; /* Pallon p√§√§lle */
            padding: 0 4px; /* Tilaa reunoille */
            transition: color var(--transition-normal);
        }
         .theme-toggle-icon.sun { color: #f59e0b; } /* Aurinko keltainen */
         .theme-toggle-icon.moon { color: #a78bfa; } /* Kuu violetti */

        /* Piilota ei-aktiivinen ikoni */
         body:not(.dark-mode) .theme-toggle-icon.moon { display: none; }
         body.dark-mode .theme-toggle-icon.sun { display: none; }


        /* ============================================
           ü¶∂ FOOTER
           ============================================ */
        .footer {
            background: var(--white-color); /* Vaalea tausta */
            color: var(--text-secondary); /* Pehme√§ teksti */
            padding: 2.5rem 0; /* Lis√§√§ paddingia */
            margin-top: auto; /* Ty√∂nn√§ sivun alaosaan */
            border-top: 1px solid var(--border-color);
            font-size: 0.9rem;
        }
        body.dark-mode .footer {
            background: var(--dark-color); /* Tumma tausta dark modessa */
             color: var(--text-secondary);
             border-top: 1px solid var(--border-color);
        }

        .footer a {
            color: var(--primary-color);
            text-decoration: none;
            transition: all var(--transition-fast);
        }
         body.dark-mode .footer a {
             color: var(--primary-light);
         }

        .footer a:hover {
            color: var(--primary-dark);
            text-decoration: underline; /* Korosta hoveria */
        }
         body.dark-mode .footer a:hover {
             color: var(--white-color);
         }

        /* ============================================
           üì± RESPONSIVE & MOBILE FIRST
           ============================================ */
        @media (max-width: 991.98px) { /* Bootstrapin lg-breakpoint */
             .navbar-nav {
                 margin-top: 1rem; /* Lis√§√§ tilaa mobiilivalikossa */
             }
             .theme-toggle-wrapper {
                 margin-top: 0.5rem;
                 justify-content: center; /* Keskit√§ mobiilissa */
             }
        }

        @media (max-width: 767.98px) { /* Bootstrapin md-breakpoint */
            .container-main {
                padding-top: 1.5rem;
                padding-bottom: 3rem;
            }
             .card:hover {
                 transform: none; /* Poista hover-nosto pienill√§ n√§yt√∂ill√§ */
             }
             h1 { font-size: 1.8rem; }
             h2 { font-size: 1.5rem; }
        }

        /* Muut vanhat tyylit s√§ilytetty */
        body.dark-mode .card *,
        body.dark-mode .card h1,
        body.dark-mode .card h2,
        body.dark-mode .card h3,
        body.dark-mode .card h4,
        body.dark-mode .card h5,
        body.dark-mode .card h6,
        body.dark-mode .card p,
        body.dark-mode .card span,
        body.dark-mode .card div {
            color: var(--text-primary) !important; /* Pakotetaan tumman tilan tekstiv√§ri */
        }
        body.dark-mode .text-muted {
             color: var(--text-secondary) !important;
        }

        /* ============================================
           üñ®Ô∏è PRINT STYLES
           ============================================ */
        @media print {
            body {
                background: white !important;
                color: black !important;
                animation: none !important;
            }
            body::before { display: none !important; }

            .no-print, nav, .navbar, .btn, footer, .theme-toggle-wrapper,
            .modal, .modal-backdrop, #flash-messages, .alert:not(.print-this) {
                display: none !important;
            }

            .container-main {
                 animation: none !important;
                 padding: 0 !important;
                 margin: 1cm !important; /* Lis√§√§ marginaalit tulostukseen */
            }

            a { text-decoration: none; color: black !important; }
            a[href^="/"]::after, a[href^="http"]::after {
                 /* content: " (" attr(href) ")"; Poistetaan linkkien tulostus */
                 content: "";
                 font-size: 90%;
                 color: #555;
            }

            .card {
                page-break-inside: avoid;
                border: 1px solid #ccc !important;
                box-shadow: none !important;
                background: white !important;
            }
             .card * { color: black !important; background: white !important; }

             h1, h2, h3, h4, h5, h6 { page-break-after: avoid; }
             p { orphans: 3; widows: 3; }

        }

    </style>

    {# Favicon - Varmista, ett√§ tiedosto on static/images kansiossa #}
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">

    {# Meta CSRF Token (k√§ytet√§√§n JavaScriptiss√§) #}
    <meta name="csrf-token" content="{{ csrf_token() }}">

    {# Blockki lis√§tyyleille yksitt√§isill√§ sivuilla #}
    {% block extra_head %}{% endblock %}

</head>
<body class="{{ 'dark-mode' if session.get('theme') == 'dark' else '' }}"> {# Aseta teema heti bodyyn #}

    <nav class="navbar navbar-expand-lg navbar-dark fixed-top"> {# K√§yt√§ fixed-top jos haluat sen pysyv√§n ylh√§√§ll√§ #}
        <div class="container-fluid"> {# K√§yt√§ fluidia leve√§mp√§√§n naviin #}
            {# Br√§ndilinkki ohjaa aina oikeaan dashboardiin #}
            <a class="navbar-brand fw-bold" href="{{ url_for('index_route') }}" data-aos="fade-right">
                <i class="fas fa-heartbeat me-2"></i>LOVe Enhanced
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup" aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
                {# Vasen puoli: Perusnavigaatio (User, Admin, Superuser) #}
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    {% if current_user.is_authenticated %}
                        {# N√§m√§ n√§kyv√§t kaikille kirjautuneille #}
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'dashboard_route' %}active{% endif %}" href="{{ url_for('dashboard_route') }}">
                                <i class="fas fa-tachometer-alt fa-fw me-1"></i>Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'practice_route' %}active{% endif %}" href="{{ url_for('practice_route') }}">
                                <i class="fas fa-book-open fa-fw me-1"></i>Harjoittele
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'calculator_route' %}active{% endif %}" href="{{ url_for('calculator_route') }}">
                                <i class="fas fa-calculator fa-fw me-1"></i>Laskuri
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'stats_route' %}active{% endif %}" href="{{ url_for('stats_route') }}">
                                <i class="fas fa-chart-line fa-fw me-1"></i>Tilastot
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'mistakes_route' %}active{% endif %}" href="{{ url_for('mistakes_route') }}">
                                <i class="fas fa-redo fa-fw me-1"></i>Kehityskohteet
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'achievements_route' %}active{% endif %}" href="{{ url_for('achievements_route') }}">
                                <i class="fas fa-trophy fa-fw me-1"></i>Saavutukset
                            </a>
                        </li>
                         {# Voit lis√§t√§ simulaatiolinkin t√§nne, jos se on kaikille #}
                         {# <li class="nav-item">
                            <a class="nav-link {% if request.endpoint == 'simulation_route' %}active{% endif %}" href="{{ url_for('simulation_route') }}">
                                <i class="fas fa-vial fa-fw me-1"></i>Simulaatio
                            </a>
                         </li> #}

                    {% endif %}
                </ul>

                {# Oikea puoli: Roolikohtaiset ja k√§ytt√§j√§valikko #}
                <ul class="navbar-nav ms-auto align-items-lg-center"> {# align-items-lg-center keskitt√§√§ vertikaalisesti isommilla n√§yt√∂ill√§ #}
                    <li class="nav-item d-flex align-items-center me-lg-3 mb-2 mb-lg-0"> {# Lis√§√§ marginaalia oikealle isommilla n√§yt√∂ill√§ #}
                        <div class="theme-toggle-wrapper" onclick="toggleTheme()" title="Vaihda teemaa">
                            <i class="fas fa-sun theme-toggle-icon sun"></i>
                            <label class="theme-toggle-switch">
                                <input type="checkbox" id="theme-toggle-checkbox" aria-label="Vaihda tumma/vaalea tila">
                                <span class="theme-toggle-icons"></span> {# K√§yt√§ t√§t√§ sliderin sijaan ikoneille #}
                            </label>
                            <i class="fas fa-moon theme-toggle-icon moon"></i>
                        </div>
                    </li>

                    {% if current_user.is_authenticated %}
                        {# --- Admin / Superuser Linkit --- #}
                        {# Tarkista ensin Superuser, sitten Admin #}
                        {% if current_user.is_superuser() %}
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle {% if request.path.startswith('/superuser') %}active{% endif %}" href="#" id="superuserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                    <i class="fas fa-crown fa-fw me-1"></i>Superuser
                                </a>
                                <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="superuserDropdown">
                                    <li><a class="dropdown-item" href="{{ url_for('admin_route') }}">SU Dashboard</a></li> {# admin_route ohjaa oikein #}
                                    <li><a class="dropdown-item" href="{{ url_for('superuser_orgs_route') }}">Organisaatiot</a></li>
                                    <li><a class="dropdown-item" href="{{ url_for('superuser_questions_route') }}">Kysymykset</a></li>
                                    {# Lis√§√§ muita superuser-linkkej√§ tarvittaessa #}
                                    <li><hr class="dropdown-divider"></li>
                                     <li><a class="dropdown-item" href="{{ url_for('admin_stats_route') }}">J√§rjestelm√§tilastot</a></li> {# Oletetaan admin_stats_route #}
                                </ul>
                            </li>
                        {% elif current_user.is_admin() %} {# T√§h√§n p√§√§tyy vain 'admin', ei 'superuser' #}
                             <li class="nav-item">
                                <a class="nav-link {% if request.path.startswith('/admin') %}active{% endif %}" href="{{ url_for('admin_route') }}">
                                    <i class="fas fa-user-shield fa-fw me-1"></i>Admin
                                </a>
                            </li>
                        {% endif %}

                        {# --- K√§ytt√§j√§valikko --- #}
                        <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" id="navbarUserDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                {# Lis√§√§ avatar tai ikoni, jos haluat #}
                                <i class="fas fa-user-circle fa-fw me-1"></i>{{ current_user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarUserDropdown"> {# glass-tyyli poistettu, voi lis√§t√§ takaisin #}
                                <li><a class="dropdown-item {% if request.endpoint == 'profile_route' %}active{% endif %}" href="{{ url_for('profile_route') }}"><i class="fas fa-user fa-fw me-2"></i>Profiili</a></li>
                                <li><a class="dropdown-item {% if request.endpoint == 'settings_route' %}active{% endif %}" href="{{ url_for('settings_route') }}"><i class="fas fa-cog fa-fw me-2"></i>Asetukset</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="{{ url_for('logout_route') }}"><i class="fas fa-sign-out-alt fa-fw me-2"></i>Kirjaudu ulos</a></li>
                            </ul>
                        </li>
                    {% else %}
                        {# --- Kirjautumattoman linkit --- #}
                        <li class="nav-item">
                            <a class="nav-link" href="{{ url_for('login_route') }}">
                                <i class="fas fa-sign-in-alt fa-fw me-1"></i>Kirjaudu sis√§√§n
                            </a>
                        </li>
                         <li class="nav-item">
                            <a class="btn btn-primary ms-lg-2" href="{{ url_for('register_route') }}"> {# K√§yt√§ nappia korostukseen #}
                                <i class="fas fa-user-plus fa-fw me-1"></i>Rekister√∂idy
                            </a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    {# T√§m√§ div ker√§√§ viestit, jotka JS sitten n√§ytt√§√§ Toasteina #}
    <div id="flash-messages" style="display: none;">
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div data-category="{{ category }}" data-message="{{ message|escape }}"></div> {# escape varmistaa turvallisuuden #}
                {% endfor %}
            {% endif %}
        {% endwith %}
    </div>

    {# P√§√§sis√§lt√∂ tulee t√§h√§n blockiin #}
    <main class="container-main container"> {# Lis√§tty container t√§h√§n yleens√§ #}
        {% block content %}{% endblock %}
    </main>

    <footer class="footer mt-auto py-4"> {# mt-auto ty√∂nt√§√§ alas, jos sis√§lt√∂ lyhyt #}
        <div class="container text-center" data-aos="fade-up">
            <small>
                <span>¬© {{ now.year }} LOVe Enhanced. Kaikki oikeudet pid√§tet√§√§n.</span> {# Dynaaminen vuosi #}
                <br class="d-block d-sm-none"> {# Rivinvaihto pienill√§ n√§yt√∂ill√§ #}
                <a href="{{ url_for('terms_route') }}" class="mx-2">K√§ytt√∂ehdot</a> |
                <a href="{{ url_for('privacy_route') }}" class="mx-2">Tietosuoja</a> |
                <a href="mailto:support@loveenhanced.fi" class="mx-2">Yhteystiedot</a>
            </small>
            {# Voit lis√§t√§ some-linkit t√§h√§n, jos haluat #}
        </div>
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-geWF76RCwLtnZ8qwWowPQNguL3RmwHVBC9FhGdlKrxdiJJigb/j/68SIy3Te4Bkz" crossorigin="anonymous"></script>

    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>

    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script>
        // ============================================
        // üé® WOW: Initialize AOS
        // ============================================
        try {
            AOS.init({
                duration: 600, // Hieman nopeampi
                easing: 'ease-out-cubic', // Pehme√§mpi
                once: true, // Animaatio vain kerran
                offset: 50 // K√§ynnistyy aiemmin
            });
        } catch (e) { console.error("AOS initialization failed:", e); }


        // ============================================
        // üîî WOW: Modern Toast Notifications for Flash
        // ============================================
        document.addEventListener('DOMContentLoaded', function() {
            const flashContainer = document.getElementById('flash-messages');
            if (flashContainer) {
                const messages = flashContainer.querySelectorAll('div[data-category]');
                messages.forEach((msg, index) => {
                    const category = msg.getAttribute('data-category');
                    const message = msg.getAttribute('data-message'); // Haetaan escape-k√§sitelty viesti

                    let backgroundColor = 'linear-gradient(135deg, #6b7280 0%, #4b5563 100%)'; // Oletus (harmaa)
                    let icon = '‚ÑπÔ∏è'; // Oletusikoni
                    let duration = 5000; // Oletuskesto (5 sekuntia)

                    switch(category) {
                        case 'success':
                            backgroundColor = 'var(--gradient-success)';
                            icon = '‚úÖ';
                            duration = 3000; // Lyhyempi kesto onnistumisille
                            break;
                        case 'danger':
                        case 'error':
                            backgroundColor = 'var(--gradient-danger)';
                            icon = '‚ùå';
                            duration = 8000; // Pidempi kesto virheille
                            break;
                        case 'warning':
                            backgroundColor = 'var(--gradient-warning)';
                            icon = '‚ö†Ô∏è';
                            duration = 7000;
                            break;
                        case 'info':
                            backgroundColor = 'var(--gradient-info)';
                            icon = 'üí°';
                            break;
                    }

                    // Luo sis√§lt√∂elementti HTML:n sallimiseksi
                    const messageNode = document.createElement('div');
                     // K√§yt√§ innerHTML:√§√§, koska flash-viesti voi sis√§lt√§√§ HTML:√§√§ (esim. salasanalinkki)
                     // Oletetaan, ett√§ backend sanitizoi flash-viestit tarvittaessa
                     messageNode.innerHTML = `${icon} ${message}`;

                    // N√§yt√§ Toast viiveell√§, jos useita viestej√§
                    setTimeout(() => {
                        Toastify({
                            node: messageNode, // K√§yt√§ nodea HTML:n n√§ytt√§miseen
                            duration: duration,
                            gravity: "top", // Ylh√§√§ll√§
                            position: "right", // Oikealla
                            stopOnFocus: true, // Pys√§htyy hoverilla
                            escapeMarkup: false, // Sallii HTML:n nodessa
                            style: {
                                background: backgroundColor,
                                borderRadius: "var(--radius-md)",
                                boxShadow: "var(--shadow-lg)",
                                fontWeight: "500",
                                fontSize: "0.95rem",
                                padding: "1rem 1.5rem", // Lis√§√§ paddingia
                                maxWidth: "400px" // Maksimileveys
                            },
                             // Lis√§√§ sulkemisnappi
                            close: true
                        }).showToast();
                    }, index * 300); // Pieni porrastus
                });
            }
        });

         // Funktio salasanan kopiointiin Toastista (jos k√§yt√§t sit√§ admin_users.html:ss√§)
         function copyPasswordFromToast(element) {
             const password = element.dataset.password;
             if (navigator.clipboard) {
                 navigator.clipboard.writeText(password).then(() => {
                     element.textContent = '‚úÖ Kopioitu!';
                     element.disabled = true;
                     // Voit poistaa napin tai muuttaa sen takaisin hetken p√§√§st√§
                 }).catch(err => {
                     console.error('Salasanan kopiointi ep√§onnistui:', err);
                     element.textContent = 'Virhe';
                 });
             } else {
                 // Fallback vanhemmille selaimille (harvinainen)
                 alert("Salasanan kopiointi ei onnistunut selaimellasi.");
             }
         }


        // ============================================
        // üåô Dark Mode Toggle Logic
        // ============================================
        const themeToggleCheckbox = document.getElementById('theme-toggle-checkbox');

        function applyTheme(theme) {
            if (theme === 'dark') {
                document.body.classList.add('dark-mode');
                if (themeToggleCheckbox) themeToggleCheckbox.checked = true;
            } else {
                document.body.classList.remove('dark-mode');
                if (themeToggleCheckbox) themeToggleCheckbox.checked = false;
            }
            // T√§ss√§ ei tarvitse kutsua updateCardColors/updateModalColors,
            // koska CSS hoitaa sen nyt body.dark-mode -valitsimilla.
        }

        function toggleTheme() {
            const isDark = document.body.classList.toggle('dark-mode');
            const newTheme = isDark ? 'dark' : 'light';
            localStorage.setItem('theme', newTheme);
            applyTheme(newTheme); // Varmista, ett√§ checkbox p√§ivittyy

            // N√§yt√§ Toast-ilmoitus teeman vaihdosta
            Toastify({
                text: isDark ? "üåô Tumma tila aktivoitu" : "‚òÄÔ∏è Vaalea tila aktivoitu",
                duration: 2000,
                gravity: "bottom",
                position: "center",
                style: {
                    background: isDark ? 'var(--gradient-primary)' : 'var(--gradient-warning)',
                    color: isDark? 'white' : 'black',
                    borderRadius: "var(--radius-md)"
                }
            }).showToast();
        }

        // Aseta teema sivun latautuessa
        document.addEventListener('DOMContentLoaded', () => {
             // Lue tallennettu teema tai j√§rjestelm√§n oletus
            const savedTheme = localStorage.getItem('theme');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const currentTheme = savedTheme || (prefersDark ? 'dark' : 'light');
            applyTheme(currentTheme);

             // Kuuntele j√§rjestelm√§n teeman muutoksia
             window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
                 // Muuta vain, jos k√§ytt√§j√§ ei ole itse valinnut teemaa (ei localStoragessa)
                 if (!localStorage.getItem('theme')) {
                     applyTheme(event.matches ? 'dark' : 'light');
                 }
             });
        });


        // ============================================
        // üîí CSRF Protection for AJAX (Fetch API example)
        // ============================================
        const csrfTokenMeta = document.querySelector('meta[name="csrf-token"]');
        const csrfToken = csrfTokenMeta ? csrfTokenMeta.getAttribute('content') : null;

        // Voit halutessasi ylikirjoittaa fetch-funktion lis√§√§m√§√§n tokenin automaattisesti
        // (Kuten edellisess√§ versiossa, mutta varmista yhteensopivuus muiden skriptien kanssa)
        // const originalFetch = window.fetch;
        // window.fetch = function(url, options = {}) { ... }


        // ============================================
        // üéØ WOW: Smooth Scroll to Top Button
        // ============================================
        let scrollToTopBtn = document.createElement('button');
        scrollToTopBtn.innerHTML = '<i class="fas fa-arrow-up"></i>';
        scrollToTopBtn.setAttribute('title', 'Sivun yl√§laitaan');
        scrollToTopBtn.className = 'btn btn-primary rounded-circle shadow-lg';
        scrollToTopBtn.style.cssText = `
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            z-index: 1050; /* Korkeammalle kuin modaalit? */
            display: none; /* Piilotettu aluksi */
            opacity: 0;
            transition: opacity var(--transition-normal), transform var(--transition-fast);
            font-size: 1.2rem;
        `;
        scrollToTopBtn.onclick = () => window.scrollTo({top: 0, behavior: 'smooth'});
        document.body.appendChild(scrollToTopBtn);

        let lastScrollTop = 0;
        window.addEventListener('scroll', () => {
            let scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            if (scrollTop > 300) { // N√§yt√§, kun vieritetty tarpeeksi alas
                 scrollToTopBtn.style.display = 'flex'; // K√§yt√§ flexi√§ keskitykseen
                 scrollToTopBtn.style.alignItems = 'center';
                 scrollToTopBtn.style.justifyContent = 'center';
                 // Feidaa sis√§√§n
                 requestAnimationFrame(() => {
                    scrollToTopBtn.style.opacity = '1';
                 });
            } else {
                 scrollToTopBtn.style.opacity = '0';
                 // Piilota vasta animaation j√§lkeen
                 setTimeout(() => {
                      if (window.scrollY <= 300) { // Tarkista uudelleen
                          scrollToTopBtn.style.display = 'none';
                      }
                 }, 300); // Odotusaika vastaa transition kestoa
            }
            // Voit lis√§t√§ logiikan, joka piilottaa napin, jos vieritet√§√§n yl√∂sp√§in
            // lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        });

    </script>

    {# Blockki lis√§skripteille yksitt√§isill√§ sivuilla #}
    {% block scripts %}{% endblock %}

</body>
</html>