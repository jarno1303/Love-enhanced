<!DOCTYPE html>
<html lang="fi">
<head>

<style>
@media print {
    body::before {
        content: "LOVe Enhanced - Kaavakirjasto";
        display: block;
        text-align: center;
        font-size: 18pt;
        font-weight: bold;
        margin-bottom: 20px;
        padding-bottom: 10px;
        border-bottom: 2px solid #000;
    }
}
</style>

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LOVe Enhanced{% endblock %}</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>

    /* Tulostusoptimointia */
@media print {
    .no-print, nav, .navbar, .btn, .card-header button, #calculatorMainTabs, footer, .alert-info { display: none !important; }
    .hide-for-print { display: none !important; }
    .card { page-break-inside: avoid; border: 2px solid #000 !important; margin-bottom: 20px !important; box-shadow: none !important; }
    .card-header { background-color: #f0f0f0 !important; border-bottom: 2px solid #000 !important; padding: 15px !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .card-body { padding: 15px !important; }
    body { font-size: 11pt; line-height: 1.4; color: #000; background: white; }
    h5 { font-size: 14pt; font-weight: bold; }
    h6 { font-size: 12pt; font-weight: bold; margin-top: 10px; }
    .alert-light { border: 1px solid #000 !important; background: #f9f9f9 !important; padding: 10px !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .bg-light { background: #f5f5f5 !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .badge { border: 1px solid #000 !important; padding: 3px 8px !important; -webkit-print-color-adjust: exact; print-color-adjust: exact; }
    .text-primary, .text-info, .text-success, .text-warning, .text-danger { color: #000 !important; }
    @page { margin: 2cm; }
    .row { page-break-inside: avoid; }
    @page { @top-center { content: "LOVe Enhanced - Kaavakirjasto"; } }
    .col-md-6 { width: 100% !important; page-break-inside: avoid; }
}

/* Tulostuksen esikatseluun */
.formula-print-checkbox {
    cursor: pointer;
    accent-color: #0d6efd;
}    
        :root {
            --primary-color: #5A67D8;
            --primary-light: #7F9CF5;
            --primary-dark: #4C51BF;
            --secondary-color: #718096;
            --accent-color: #ED64A6;
            --success-color: #48BB78;
            --warning-color: #ECC94B;
            --danger-color: #F56565;
            --light-bg: #F7FAFC;
            --light-hover: #EDF2F7;
            --medium-color: #A0AEC0;
            --dark-color: #2D3748;
            --white-color: #FFFFFF;
            --border-color: #E2E8F0;
            --text-primary: #2D3748;
            --text-secondary: #718096;
            --gold: #ECC94B;
            --silver: #E2E8F0;
            --bronze: #CD7F32;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-dark) 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.5rem;
            color: white !important;
        }
        
        .nav-link {
            color: rgba(255, 255, 255, 0.9) !important;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-link:hover {
            color: white !important;
        }
        
        .container-main {
            min-height: calc(100vh - 56px);
            padding: 2rem 0;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background-color: var(--primary-dark);
            border-color: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        
        .alert {
            border-radius: 8px;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }
        
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
        }
        
        .footer {
            background-color: var(--dark-color);
            color: var(--medium-color);
            padding: 2rem 0;
            margin-top: 4rem;
        }
        
        .footer a {
            color: var(--primary-light);
            text-decoration: none;
        }
        
        .footer a:hover {
            color: var(--white-color);
        }
        
        /* Dark mode styles - PARANNETTU! */
        body.dark-mode {
            --primary-color: #8b5cf6;
            --primary-light: #a78bfa;
            --primary-dark: #7c3aed;
            --secondary-color: #14b8a6;
            --accent-color: #ec4899;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --light-bg: #0f0f0f;
            --light-hover: #1a1a1a;
            --medium-color: #6b7280;
            --dark-color: #030712;
            --white-color: #171717;
            --border-color: #27272a;
            --text-primary: #f9fafb;
            --text-secondary: #9ca3af;
            --gold: #fbbf24;
            --silver: #d1d5db;
            --bronze: #d97706;
        }
        
        /* Dark mode navigaatio - PALJON TUMMEMPI! */
        body.dark-mode .navbar {
            background: linear-gradient(135deg, #1e1b4b 0%, #0f172a 100%) !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.4);
        }
        
        /* Dark mode kortit - hillitympi */
        body.dark-mode .card {
            background-color: #1a1a1a;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }
        
        body.dark-mode .card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.4);
        }
        
        /* Dark mode kortit - JavaScript vaihtaa v√§rit, CSS hoitaa vain tekstit */
        
        /* Dark mode - alemmat kortit ilman gradienttia */
        body.dark-mode .card {
            background-color: #1a1a1a !important;
            border: 1px solid #2d2d2d;
        }
        
        /* Dark mode - Poista reunat gradient-korteilta */
        body.dark-mode div[style*="gradient"] {
            border: none !important;
        }
        
        /* Dark mode - varmista ett√§ kaikki tekstit n√§kyv√§t */
        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode h3,
        body.dark-mode h4,
        body.dark-mode h5,
        body.dark-mode h6,
        body.dark-mode p {
            color: var(--text-primary);
        }
        
        /* Dark mode - PAKOTA valkoinen teksti KAIKILLE kortin elementeille */
        body.dark-mode .card,
        body.dark-mode .card *,
        body.dark-mode .card h1,
        body.dark-mode .card h2,
        body.dark-mode .card h3,
        body.dark-mode .card h4,
        body.dark-mode .card h5,
        body.dark-mode .card h6,
        body.dark-mode .card p,
        body.dark-mode .card span,
        body.dark-mode .card div,
        body.dark-mode .card button,
        body.dark-mode .card .btn,
        body.dark-mode div[style*="gradient"],
        body.dark-mode div[style*="gradient"] *,
        body.dark-mode div[style*="gradient"] h1,
        body.dark-mode div[style*="gradient"] h2,
        body.dark-mode div[style*="gradient"] h3,
        body.dark-mode div[style*="gradient"] h4,
        body.dark-mode div[style*="gradient"] h5,
        body.dark-mode div[style*="gradient"] h6,
        body.dark-mode div[style*="gradient"] p,
        body.dark-mode div[style*="gradient"] span,
        body.dark-mode div[style*="gradient"] div,
        body.dark-mode div[style*="gradient"] button,
        body.dark-mode div[style*="gradient"] .btn,
        body.dark-mode div[style*="background"] *,
        body.dark-mode div[style*="background"] h1,
        body.dark-mode div[style*="background"] h2,
        body.dark-mode div[style*="background"] h3,
        body.dark-mode div[style*="background"] h4,
        body.dark-mode div[style*="background"] h5,
        body.dark-mode div[style*="background"] h6,
        body.dark-mode div[style*="background"] p,
        body.dark-mode div[style*="background"] span,
        body.dark-mode div[style*="background"] div {
            color: #ffffff !important;
        }
        
        /* Dark mode - ERITYISESTI kortit joilla on JavaScript-lis√§tty background */
        body.dark-mode div[style*="linear-gradient"],
        body.dark-mode div[style*="linear-gradient"] *,
        body.dark-mode div[style*="linear-gradient"] h1,
        body.dark-mode div[style*="linear-gradient"] h2,
        body.dark-mode div[style*="linear-gradient"] h3,
        body.dark-mode div[style*="linear-gradient"] h4,
        body.dark-mode div[style*="linear-gradient"] h5,
        body.dark-mode div[style*="linear-gradient"] h6,
        body.dark-mode div[style*="linear-gradient"] p,
        body.dark-mode div[style*="linear-gradient"] span,
        body.dark-mode div[style*="linear-gradient"] div {
            color: #ffffff !important;
        }
        
        /* Dark mode - Pakota valkoinen MY√ñS hover-tilassa */
        body.dark-mode div[style*="linear-gradient"]:hover,
        body.dark-mode div[style*="linear-gradient"]:hover *,
        body.dark-mode div[style*="linear-gradient"] *:hover {
            color: #ffffff !important;
        }
        
        /* Dark mode - TUMMAT PAINIKKEET JA INPUT-KENT√ÑT */
        body.dark-mode button,
        body.dark-mode .btn,
        body.dark-mode input[type="text"],
        body.dark-mode input[type="email"],
        body.dark-mode input[type="password"],
        body.dark-mode textarea,
        body.dark-mode select {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
            border-color: #4a4a4a !important;
        }
        
        /* Dark mode - Painikkeet gradient-korteissa */
        body.dark-mode div[style*="linear-gradient"] button,
        body.dark-mode div[style*="linear-gradient"] .btn {
            background-color: rgba(0, 0, 0, 0.3) !important;
            color: #ffffff !important;
            border: 1px solid rgba(255, 255, 255, 0.3) !important;
        }
        
        /* Dark mode - Painikkeet hover */
        body.dark-mode button:hover,
        body.dark-mode .btn:hover {
            background-color: #3a3a3a !important;
            color: #ffffff !important;
        }
        
        /* Dark mode - NUMEROT JA BADGET */
        body.dark-mode .badge,
        body.dark-mode .badge *,
        body.dark-mode span[class*="badge"],
        body.dark-mode div[class*="badge"] {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
            border: 1px solid #4a4a4a !important;
        }
        
        /* Dark mode - Numerot gradient-korteissa - VARJO KONTRASTILLE */
        body.dark-mode div[style*="linear-gradient"] h1,
        body.dark-mode div[style*="linear-gradient"] h2,
        body.dark-mode div[style*="linear-gradient"] h3,
        body.dark-mode div[style*="linear-gradient"] .display-1,
        body.dark-mode div[style*="linear-gradient"] .display-2,
        body.dark-mode div[style*="linear-gradient"] .display-3,
        body.dark-mode div[style*="linear-gradient"] .display-4 {
            color: #000000 !important;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3) !important;
        }
        
        /* Dark mode - KAIKKI lihavoidut numerot mustiksi */
        body.dark-mode div[style*="linear-gradient"] strong,
        body.dark-mode div[style*="linear-gradient"] b {
            color: #000000 !important;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.3) !important;
        }
        
        /* Dark mode - Isot numerot yleisesti */
        body.dark-mode h1,
        body.dark-mode h2,
        body.dark-mode .display-1,
        body.dark-mode .display-2,
        body.dark-mode .display-3,
        body.dark-mode .display-4 {
            text-shadow: 1px 1px 4px rgba(0, 0, 0, 0.5);
        }
        
        /* Dark mode - MODAALIT */
        body.dark-mode .modal-content {
            background-color: #1a1a1a !important;
            color: #ffffff !important;
            border: 1px solid #2d2d2d !important;
        }
        
        body.dark-mode .modal-header {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
            border-bottom: 1px solid #4a4a4a !important;
        }
        
        body.dark-mode .modal-body {
            background-color: #1a1a1a !important;
            color: #ffffff !important;
        }
        
        body.dark-mode .modal-footer {
            background-color: #2d2d2d !important;
            border-top: 1px solid #4a4a4a !important;
        }
        
        body.dark-mode .modal-title {
            color: #ffffff !important;
        }
        
        /* Dark mode - Modaalien tekstit */
        body.dark-mode .modal *,
        body.dark-mode .modal label,
        body.dark-mode .modal p,
        body.dark-mode .modal span {
            color: #ffffff !important;
        }
        
        /* Dark mode - Modaalien input-kent√§t */
        body.dark-mode .modal input,
        body.dark-mode .modal select,
        body.dark-mode .modal textarea {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
            border: 1px solid #4a4a4a !important;
        }
        
        /* Dark mode - Modaalien checkboxit */
        body.dark-mode .modal .form-check-label {
            color: #ffffff !important;
        }
        
        /* Dark mode - VALKOISET LAATIKOT modaaleissa */
        body.dark-mode .modal .card,
        body.dark-mode .modal .list-group,
        body.dark-mode .modal .list-group-item,
        body.dark-mode .modal div[style*="background-color: white"],
        body.dark-mode .modal div[style*="background-color:#fff"],
        body.dark-mode .modal div[style*="background: white"],
        body.dark-mode .modal .bg-white,
        body.dark-mode .modal .bg-light {
            background-color: #2d2d2d !important;
            color: #ffffff !important;
            border-color: #4a4a4a !important;
        }
        
        /* Dark mode - Checkbox-alueet */
        body.dark-mode .form-check,
        body.dark-mode .checkbox-group,
        body.dark-mode [class*="checkbox"] {
            background-color: transparent !important;
        }
        
        /* Dark mode - Modal backdrop */
        body.dark-mode .modal-backdrop {
            background-color: #000000 !important;
        }
        
        /* Dark mode - Varmista ett√§ tekstit korteissa ovat luettavia */
        body.dark-mode .card:not([style*="gradient"]) {
            background-color: #1a1a1a !important;
            color: #ffffff !important;
        }
        
        body.dark-mode .card:not([style*="gradient"]) * {
            color: #ffffff !important;
        }
        
        /* Dark mode - Erityisesti pienet tekstit ja numerot */
        body.dark-mode small,
        body.dark-mode .small,
        body.dark-mode .text-muted {
            color: #b3b3b3 !important;
        }
        
        /* Dark mode - body taustav√§ri */
        body.dark-mode {
            background-color: var(--light-bg);
        }

        /* MODERNI TOGGLE SWITCH */
        .theme-toggle-wrapper {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.25rem 0.75rem;
        }
        
        .theme-toggle-label {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.8);
            font-weight: 500;
            margin-right: 0.25rem;
            white-space: nowrap;
        }
        
        .theme-toggle-switch {
            position: relative;
            display: inline-block;
            width: 48px;
            height: 24px;
        }
        
        .theme-toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .theme-toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(255, 255, 255, 0.2);
            transition: 0.3s;
            border-radius: 24px;
            border: 2px solid rgba(255, 255, 255, 0.3);
        }
        
        .theme-toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 2px;
            bottom: 2px;
            background-color: white;
            transition: 0.3s;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        
        .theme-toggle-switch input:checked + .theme-toggle-slider {
            background-color: rgba(139, 92, 246, 0.6);
            border-color: rgba(139, 92, 246, 0.8);
        }
        
        .theme-toggle-switch input:checked + .theme-toggle-slider:before {
            transform: translateX(24px);
            background-color: #a78bfa;
        }
        
        .theme-toggle-icon {
            font-size: 0.875rem;
            color: rgba(255, 255, 255, 0.9);
            transition: color 0.3s ease;
        }
        
        body.dark-mode .theme-toggle-icon.moon {
            color: rgba(255, 255, 255, 0.5);
        }
        
        body.dark-mode .theme-toggle-icon.sun {
            color: #fbbf24;
        }

        /* Laskuri-sivun parannukset */
        #formulas-section .card {
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        #formulas-section .card-body {
            flex: 1;
        }

        .container-fluid {
            max-width: 1600px;
            margin: 0 auto;
        }

        /* Tiiviimpi rivitys kaavakorteissa */
        #formulas-section .card-body p {
            margin-bottom: 0.5rem;
        }

        #formulas-section .card-body .bg-light {
            font-size: 0.9rem;
        }

        /* EST√Ñ MODAL-VILKKUMINEN - RADIKAALI RATKAISU */
        .modal * {
            pointer-events: auto !important;
        }

        .modal .btn,
        .modal button,
        .modal .btn-primary,
        .modal .btn-secondary,
        .modal .btn-danger,
        .modal .btn-warning {
            transition: none !important;
            transform: none !important;
            box-shadow: none !important;
            border-width: 1px !important;
            padding: 0.375rem 0.75rem !important;
        }

        .modal .btn:hover,
        .modal button:hover,
        .modal .btn-primary:hover,
        .modal .btn-secondary:hover,
        .modal .btn-danger:hover,
        .modal .btn-warning:hover,
        .modal .btn:focus,
        .modal button:focus {
            transition: none !important;
            transform: none !important;
            box-shadow: none !important;
            border-width: 1px !important;
            padding: 0.375rem 0.75rem !important;
        }

    </style>
    
    <link rel="icon" href="{{ url_for('static', filename='images/favicon.ico') }}" type="image/x-icon">
    
    {% block extra_head %}{% endblock %}
    
    <meta name="csrf-token" content="{{ csrf_token() }}">
    
    <script>
        // CSRF-token kaikille AJAX-pyynn√∂ille
        document.addEventListener('DOMContentLoaded', function() {
            const csrfToken = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            
            // Lis√§√§ CSRF-token kaikkiin fetch-pyynt√∂ihin
            const originalFetch = window.fetch;
            window.fetch = function(url, options = {}) {
                if (!options.method || options.method.toUpperCase() === 'GET') {
                    return originalFetch(url, options);
                }
                if (!options.headers) {
                    options.headers = {};
                }
                if (!options.headers['X-CSRFToken'] && !options.headers['X-CSRF-Token']) {
                    options.headers['X-CSRFToken'] = csrfToken;
                }
                return originalFetch(url, options);
            };
            
            console.log('‚úÖ CSRF protection initialized');
        });
        
        // Dark mode toggle - PARANNETTU + V√ÑRIEN VAIHTO!
        function toggleTheme() {
            const body = document.body;
            const isDark = body.classList.toggle('dark-mode');
            localStorage.setItem('theme', isDark ? 'dark' : 'light');
            
            // P√§ivit√§ toggle checkbox
            const checkbox = document.getElementById('theme-toggle-checkbox');
            if (checkbox) {
                checkbox.checked = isDark;
            }
            
            // Vaihda korttien v√§rit
            updateCardColors(isDark);
            
            // Vaihda modaalien v√§rit
            updateModalColors(isDark);
            
            console.log('üåó Theme toggled:', isDark ? 'Dark mode' : 'Light mode');
        }
        
        // Uusi funktio: Tummenna modaalit
        function updateModalColors(isDark) {
            console.log('üî≤ Updating modal colors, isDark:', isDark);
            
            if (isDark) {
                // Etsi kaikki modaalit JA niiden sis√§lt√∂
                const allElements = document.querySelectorAll('*');
                let changedCount = 0;
                
                allElements.forEach(element => {
                    // Tarkista onko elementti modaalissa
                    const isInModal = element.closest('.modal') || 
                                     element.closest('.modal-dialog') || 
                                     element.classList.contains('modal') ||
                                     element.classList.contains('modal-content') ||
                                     element.classList.contains('modal-body');
                    
                    if (isInModal) {
                        const computedStyle = window.getComputedStyle(element);
                        const bgColor = computedStyle.backgroundColor;
                        
                        // Jos tausta on valkoinen tai vaalea
                        if (bgColor.includes('255, 255, 255') || 
                            bgColor.includes('rgb(255') ||
                            bgColor.includes('248, 249') ||
                            bgColor.includes('240, 240')) {
                            
                            element.style.setProperty('background-color', '#2d2d2d', 'important');
                            element.style.setProperty('color', '#ffffff', 'important');
                            changedCount++;
                        }
                    }
                });
                
                console.log(`‚úÖ Darkened ${changedCount} modal elements`);
            }
        }
        
        // Funktio joka vaihtaa korttien v√§rit - UUSI TAPA
        function updateCardColors(isDark) {
            console.log('üé® updateCardColors called, isDark:', isDark);
            
            // Etsi kaikki kortit
            const allDivs = document.querySelectorAll('div');
            let changedCount = 0;
            
            allDivs.forEach(element => {
                // Tarkista computed style (todellinen v√§ri)
                const computedStyle = window.getComputedStyle(element);
                const bgImage = computedStyle.backgroundImage;
                
                if (bgImage && bgImage.includes('gradient')) {
                    changedCount++;
                    console.log('Found element with gradient:', element);
                    console.log('Current background:', bgImage);
                    
                    if (isDark) {
                        // Tunnista v√§rit ja vaihda
                        // Violetti (667eea, 764ba2)
                        if (bgImage.match(/102.*238|118.*186/)) {
                            element.style.background = 'linear-gradient(135deg, #3730a3 0%, #312e81 100%)';
                            forceWhiteText(element);
                            console.log('‚úÖ Changed to dark purple');
                        }
                        // Pinkki (ec4899, f472b6) 
                        else if (bgImage.match(/236.*72.*153|244.*114.*182/)) {
                            element.style.background = 'linear-gradient(135deg, #9f1239 0%, #831843 100%)';
                            forceWhiteText(element);
                            console.log('‚úÖ Changed to dark pink');
                        }
                        // Syaani/Turkoosi (06b6d4, 0ea5e9)
                        else if (bgImage.match(/6.*182.*212|14.*165.*233/)) {
                            element.style.background = 'linear-gradient(135deg, #0e7490 0%, #0c4a6e 100%)';
                            forceWhiteText(element);
                            console.log('‚úÖ Changed to dark cyan');
                        }
                        // Yleinen violetti/sininen
                        else if (bgImage.match(/gradient/) && (element.textContent.includes('harjoittelu') || element.classList.contains('card'))) {
                            element.style.background = 'linear-gradient(135deg, #3730a3 0%, #312e81 100%)';
                            forceWhiteText(element);
                            console.log('‚úÖ Changed generic card to dark purple');
                        }
                    } else {
                        // Light mode - poista inline style
                        element.style.background = '';
                        removeWhiteText(element);
                        console.log('‚úÖ Removed dark style');
                    }
                }
            });
            
            console.log(`‚úÖ Changed ${changedCount} elements`);
        }
        
        // Pakottaa kaikki tekstit valkoisiksi elementiss√§
        function forceWhiteText(element) {
            // Vaihda elementin itsens√§ v√§ri VAHVASTI
            element.style.setProperty('color', '#ffffff', 'important');
            
            // Vaihda KAIKKIEN lapsielementtien v√§rit
            const allChildren = element.querySelectorAll('*');
            allChildren.forEach(child => {
                child.style.setProperty('color', '#ffffff', 'important');
                
                // Etsi numeroita tekstist√§ ja muuta ne mustiksi
                if (child.childNodes.length > 0) {
                    child.childNodes.forEach(node => {
                        if (node.nodeType === 3) { // Text node
                            const text = node.textContent;
                            // Jos tekstiss√§ on numeroita
                            if (/\d/.test(text)) {
                                // Korvaa teksti HTML:ll√§ jossa numerot mustina
                                const newHTML = text.replace(/(\d+)/g, '<span style="color: #000000 !important; text-shadow: 1px 1px 2px rgba(255,255,255,0.3) !important; font-weight: bold;">$1</span>');
                                const tempDiv = document.createElement('div');
                                tempDiv.innerHTML = newHTML;
                                while (tempDiv.firstChild) {
                                    node.parentNode.insertBefore(tempDiv.firstChild, node);
                                }
                                node.parentNode.removeChild(node);
                                console.log('‚úÖ Changed numbers to black in text:', text);
                            }
                        }
                    });
                }
            });
            
            // POIKKEUS: Isot otsikkonumerot mustiksi
            const bigNumbers = element.querySelectorAll('h1, h2, .display-1, .display-2, .display-3, .display-4');
            bigNumbers.forEach(num => {
                const text = num.textContent.trim();
                if (text.length <= 3 && /^\d+$/.test(text)) {
                    num.style.setProperty('color', '#000000', 'important');
                    num.style.setProperty('text-shadow', '1px 1px 2px rgba(255, 255, 255, 0.3)', 'important');
                    console.log('‚úÖ Changed big number to black:', text);
                }
            });
            
            console.log('‚úÖ Forced white text and black numbers');
        }
        
        // Poistaa pakotetun valkoisen tekstin
        function removeWhiteText(element) {
            element.style.removeProperty('color');
            const allChildren = element.querySelectorAll('*');
            allChildren.forEach(child => {
                child.style.removeProperty('color');
            });
        }
        
        // Load saved theme on page load
        document.addEventListener('DOMContentLoaded', function() {
            const savedTheme = localStorage.getItem('theme');
            const checkbox = document.getElementById('theme-toggle-checkbox');
            
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-mode');
                if (checkbox) {
                    checkbox.checked = true;
                }
                // T√ÑRKE√Ñ: Vaihda v√§rit kun sivu latautuu dark modessa
                setTimeout(() => {
                    updateCardColors(true);
                    updateModalColors(true);
                }, 100);
                console.log('üåô Dark mode loaded from localStorage');
            } else {
                console.log('‚òÄÔ∏è Light mode active');
            }
            
            // PAREMPI TAPA: MutationObserver joka tarkkailee DOM-muutoksia
            const observer = new MutationObserver(function(mutations) {
                if (document.body.classList.contains('dark-mode')) {
                    mutations.forEach(function(mutation) {
                        mutation.addedNodes.forEach(function(node) {
                            if (node.nodeType === 1) { // Element node
                                // Jos lis√§ttiin modaali
                                if (node.classList && (node.classList.contains('modal') || node.classList.contains('modal-dialog'))) {
                                    console.log('üî• Modal detected by MutationObserver!');
                                    setTimeout(() => updateModalColors(true), 50);
                                }
                                // Tai jos modaali on sis√§ll√§
                                const modals = node.querySelectorAll('.modal, .modal-dialog, .modal-content');
                                if (modals.length > 0) {
                                    console.log('üî• Modal content detected!');
                                    setTimeout(() => updateModalColors(true), 50);
                                }
                            }
                        });
                    });
                }
            });
            
            // Tarkkaile koko bodya
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
            
            console.log('üëÄ MutationObserver initialized for modals');
        });
    </script>
</head>
<body>
    <nav class="navbar navbar-expand-lg navbar-dark" style="background-color: #4a5568;">
    <div class="container-fluid">
        <a class="navbar-brand fw-bold" href="{{ url_for('dashboard_route') }}">
            <i class="fas fa-heartbeat me-2"></i>LOVe Enhanced
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'dashboard_route' %}active{% endif %}" href="{{ url_for('dashboard_route') }}">
                        <i class="fas fa-tachometer-alt me-1"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'practice_route' %}active{% endif %}" href="{{ url_for('practice_route') }}">
                        <i class="fas fa-book-open me-1"></i>Harjoittele
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'calculator_route' %}active{% endif %}" href="{{ url_for('calculator_route') }}">
                        <i class="fas fa-calculator me-1"></i>Laskuri
                    </a>
                </li>
                 <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'stats_route' %}active{% endif %}" href="{{ url_for('stats_route') }}">
                        <i class="fas fa-chart-line me-1"></i>Tilastot
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'mistakes_route' %}active{% endif %}" href="{{ url_for('mistakes_route') }}">
                        <i class="fas fa-redo me-1"></i>Kehityskohteet
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link {% if request.endpoint == 'achievements_route' %}active{% endif %}" href="{{ url_for('achievements_route') }}">
                        <i class="fas fa-trophy me-1"></i>Saavutukset
                    </a>
                </li>
            </ul>
            <ul class="navbar-nav ms-auto">
                <!-- MODERNI DARK MODE TOGGLE -->
                <li class="nav-item d-flex align-items-center">
                    <div class="theme-toggle-wrapper">
                        <span class="theme-toggle-label">Dark Mode</span>
                        <i class="fas fa-sun theme-toggle-icon sun"></i>
                        <label class="theme-toggle-switch" title="Vaihda teemaa">
                            <input type="checkbox" id="theme-toggle-checkbox" onchange="toggleTheme()" aria-label="Vaihda tumma/vaalea tila">
                            <span class="theme-toggle-slider"></span>
                        </label>
                        <i class="fas fa-moon theme-toggle-icon moon"></i>
                    </div>
                </li>
                {% if current_user.is_authenticated %}
                    {% if current_user.is_admin() %}
                        <li class="nav-item">
                            <a class="nav-link {% if request.endpoint in ['admin_route', 'admin_users_route'] %}active{% endif %}" href="{{ url_for('admin_route') }}">
                                <i class="fas fa-user-shield me-1"></i>Admin
                            </a>
                        </li>
                    {% endif %}
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarUserDropdown" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user-circle me-1"></i>{{ current_user.username }}
                        </a>
                        <ul class="dropdown-menu dropdown-menu-end">
                            <li><a class="dropdown-item" href="{{ url_for('profile_route') }}">Profiili</a></li>
                            <li><a class="dropdown-item" href="{{ url_for('settings_route') }}">Asetukset</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="{{ url_for('logout_route') }}">Kirjaudu ulos</a></li>
                        </ul>
                    </li>
                {% else %}
                    <li class="nav-item">
                        <a class="nav-link" href="{{ url_for('login_route') }}">Kirjaudu sis√§√§n</a>
                    </li>
                {% endif %}
            </ul>
        </div>
    </div>
</nav>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="container mt-3">
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
    {% endwith %}

    <div class="container-main">
        {% block content %}{% endblock %}
    </div>

    <footer class="footer mt-auto py-3 bg-dark text-white">
    <div class="container text-center">
        <small>
            <span>¬© 2025 LOVe Enhanced. Kaikki oikeudet pid√§tet√§√§n.</span>
            <br>
            <a href="{{ url_for('terms_route') }}" class="text-white-50">K√§ytt√∂ehdot</a> | 
            <a href="{{ url_for('privacy_route') }}" class="text-white-50">Tietosuojaseloste</a> | 
            <a href="mailto:[Oma S√§hk√∂postisi]" class="text-white-50">Yhteystiedot</a>
        </small>
    </div>
</footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    {% block extra_scripts %}{% endblock %}
</body>
</html>