{% extends "base.html" %}
{% block title %}Oma profiili - LOVe Enhanced{% endblock %}

{% block content %}
<div class="container" style="max-width: 800px;">
Â  Â  
Â  Â  <div id="recommendation-container" class="mb-4"></div>

Â  Â  <h1 class="mb-4">ðŸ‘¤ Oma profiili</h1>

Â  Â  <div class="card shadow-sm mb-4">
Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  KÃ¤yttÃ¤jÃ¤n tiedot
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  <p><strong>KÃ¤yttÃ¤jÃ¤nimi:</strong> {{ current_user.username }}</p>
Â  Â  Â  Â  Â  Â  <p class="mb-0"><strong>SÃ¤hkÃ¶posti:</strong> {{ current_user.email }}</p>
Â  Â  Â  Â  </div>
Â  Â  </div>

Â  Â  <div class="card shadow-sm">
Â  Â  Â  Â  <div class="card-header">
Â  Â  Â  Â  Â  Â  Tilastojen yhteenveto
Â  Â  Â  Â  </div>
Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  {% if stats.general and stats.general.total_attempts > 0 %}
Â  Â  Â  Â  Â  Â  <div class="row text-center">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="display-6">{{ stats.general.total_attempts }}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-muted">Vastattua kysymystÃ¤</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="display-6">{{ '%.1f'|format(stats.general.avg_success_rate * 100) }}%</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-muted">Onnistumisprosentti</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-4">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h3 class="display-6">{{ stats.weekly_progress|length }}</h3>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-muted">Aktiivista pÃ¤ivÃ¤Ã¤ (viime viikko)</p>
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  <hr>
Â  Â  Â  Â  Â  Â  <div class="row mt-3">
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5>Vahvin kategoria</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set best_category = stats.categories|sort(attribute='success_rate', reverse=true)|first %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% if best_category %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="fs-5">{{ best_category.category.title() }} <span class="badge bg-success">{{ '%.1f'|format(best_category.success_rate * 100) }}%</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="text-muted">Ei vielÃ¤ tarpeeksi dataa.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  <div class="col-md-6">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5>Heikoin kategoria</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% set worst_category = stats.categories|sort(attribute='success_rate')|first %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% if worst_category %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="fs-5">{{ worst_category.category.title() }} <span class="badge bg-danger">{{ '%.1f'|format(worst_category.success_rate * 100) }}%</span></p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â <p class="text-muted">Ei vielÃ¤ tarpeeksi dataa.</p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  {% else %}
Â  Â  Â  Â  Â  Â  <p class="text-muted">Tilastoja ei ole vielÃ¤ saatavilla. Tee harjoituksia kerÃ¤tÃ¤ksesi dataa!</p>
Â  Â  Â  Â  Â  Â  {% endif %}
Â  Â  Â  Â  </div>
Â  Â  </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', () => {
Â  Â  const recommendationContainer = document.getElementById('recommendation-container');
Â  Â  async function fetchRecommendations() {
Â  Â  Â  Â  try {
Â  Â  Â  Â  Â  Â  // HUOM: api/recommendations ei ollut mukana, tÃ¤mÃ¤ pitÃ¤Ã¤ lisÃ¤tÃ¤ app.py:hin
Â  Â  Â  Â  Â  Â  // tai suosituslogiikka pitÃ¤Ã¤ siirtÃ¤Ã¤ Python-puolelle (kuten dashboardissa jo on)
Â  Â  Â  Â  Â  Â  const response = await fetch('/api/recommendations');
Â  Â  Â  Â  Â  Â  if (!response.ok) return;
Â  Â  Â  Â  Â  Â  const recommendations = await response.json();
Â  Â  Â  Â  Â  Â  if (recommendations && recommendations.length > 0) {
Â  Â  Â  Â  Â  Â  Â  Â  const weakest = recommendations[0];
Â  Â  Â  Â  Â  Â  Â  Â  if (weakest.type === 'weakest_category' && weakest.category) {
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const practiceUrl = `/practice?categories=${encodeURIComponent(weakest.category)}&count=5`;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Oletetaan, ettÃ¤ accuracy on 0-100 vÃ¤lillÃ¤, jos .toFixed(0) antaa kokonaisluvun.
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Korjataan se nyt vastaamaan Jinja-logiikkaa (0.0-1.0), jos accuracy on 0.0-1.0
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  // Laske uudelleen: jos accuracy on esim. 0.85, se * 100
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const accuracyPercent = (weakest.accuracy > 1.0) ? weakest.accuracy.toFixed(0) : (weakest.accuracy * 100).toFixed(0); 

Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  const recommendationHtml = `
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card bg-info-subtle text-info-emphasis shadow-sm border-info">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="card-body">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="d-flex align-items-center">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div class="fs-2 me-3">ðŸ’¡</div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <h5 class="card-title">HenkilÃ¶kohtainen suositus</h5>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <p class="card-text mb-2">
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Huomasimme, ettÃ¤ kategoriassa <strong>${weakest.category.charAt(0).toUpperCase() + weakest.category.slice(1)}</strong> on eniten kehitettÃ¤vÃ¤Ã¤ (${accuracyPercent}% oikein).
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </p>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <a href="${practiceUrl}" class="btn btn-primary btn-sm">Aloita 5 kysymyksen kertaus</a>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  </div>
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  `;
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  recommendationContainer.innerHTML = recommendationHtml;
Â  Â  Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } catch (error) {
Â  Â  Â  Â  Â  Â  console.error("Suositusten hakeminen epÃ¤onnistui:", error);
Â  Â  Â  Â  }
Â  Â  }
Â  Â  fetchRecommendations();
});
</script>
{% endblock %}